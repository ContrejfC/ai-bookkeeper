{"openapi":"3.1.0","info":{"title":"AI Bookkeeper","description":"AI-powered bookkeeping with automated journal entry posting","version":"0.2.1-beta"},"paths":{"/api/auth/login":{"post":{"tags":["auth"],"summary":"Login","description":"Authenticate user and issue JWT token.\n\nModes:\n- dev: Allows magic link bypass (magic_token=\"dev\")\n- prod: Requires password validation\n\nResponse:\n- Sets HttpOnly, Secure, SameSite=Lax cookie for UI\n- Returns token in body for API clients","operationId":"login_api_auth_login_post","parameters":[{"name":"use_cookie","in":"query","required":false,"schema":{"type":"boolean","default":true,"title":"Use Cookie"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/signup":{"post":{"tags":["auth"],"summary":"Signup","description":"Create a new user account.\n\nCreates a new user with owner role and sets up authentication.","operationId":"signup_api_auth_signup_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignupRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/signup/test":{"get":{"tags":["auth"],"summary":"Test Signup Route","description":"Test endpoint to verify signup route works.","operationId":"test_signup_route_api_auth_signup_test_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/logout":{"post":{"tags":["auth"],"summary":"Logout","description":"Clear session cookie.\n\nReturns:\n    Success message","operationId":"logout_api_auth_logout_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/me":{"get":{"tags":["auth"],"summary":"Get Current User Info","description":"Get current authenticated user information.\n\nSupports:\n- Cookie-based auth (access_token cookie)\n- Bearer token auth (Authorization header)\n\nReturns:\n    User information","operationId":"get_current_user_info_api_auth_me_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/tenants":{"get":{"tags":["tenants"],"summary":"List Tenants","description":"List all tenants visible to current user (DB-backed, no mocks).\n\nRBAC:\n- Owner: sees all tenants\n- Staff: only assigned tenants","operationId":"list_tenants_api_tenants_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/TenantResponse"},"title":"Response List Tenants Api Tenants Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/tenants/{tenant_id}":{"get":{"tags":["tenants"],"summary":"Get Tenant","description":"Get tenant details (DB-backed, no mocks).\n\nRBAC: User must have view access to tenant.","operationId":"get_tenant_api_tenants__tenant_id__get","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"string","title":"Tenant Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/tenants/{tenant_id}/settings":{"post":{"tags":["tenants"],"summary":"Update Tenant Settings","description":"Update tenant settings with DB persistence (UPSERT).\n\nRBAC: Requires owner role and tenant access.\n\nValidation:\n- autopost_threshold: 0.80 - 0.98\n- llm_tenant_cap_usd: 0 - 10000\n\nAudit: Writes to decision_audit_log.","operationId":"update_tenant_settings_api_tenants__tenant_id__settings_post","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"string","title":"Tenant Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantSettings"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/rules/candidates":{"get":{"tags":["rules"],"summary":"List Candidates","description":"List rule candidates.\n\nArgs:\n    status: Filter by status (pending, accepted, rejected)\n    \nReturns:\n    List of candidates","operationId":"list_candidates_api_rules_candidates_get","parameters":[{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"default":"pending","title":"Status"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/CandidateResponse"},"title":"Response List Candidates Api Rules Candidates Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/rules/dryrun":{"post":{"tags":["rules"],"summary":"Dryrun Rule Promotion","description":"Simulate rule promotion impact (NO MUTATION, READ-ONLY).\n\nComputes:\n- Current automation rate and reason counts\n- Projected automation rate if rules applied\n- Affected transaction IDs\n- Deltas for all metrics\n\nValidation:\n- Uses read-only transaction\n- No database writes\n- Logs dry-run to audit (separate transaction)\n\nArgs:\n    request: Candidate IDs and optional tenant scope\n    \nReturns:\n    Impact analysis with before/after metrics","operationId":"dryrun_rule_promotion_api_rules_dryrun_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DryRunRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DryRunResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/rules/candidates/{id}/accept":{"post":{"tags":["rules"],"summary":"Accept Candidate","description":"Promote candidate to accepted rule.\n\nSteps:\n1. Validate candidate exists and is pending\n2. Check for idempotency (already accepted)\n3. Update candidate status\n4. Create new rule version\n5. Write audit entry\n\nReturns:\n    Success response with version ID","operationId":"accept_candidate_api_rules_candidates__id__accept_post","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","title":"Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/rules/candidates/{id}/reject":{"post":{"tags":["rules"],"summary":"Reject Candidate","description":"Decline candidate.\n\nArgs:\n    id: Candidate ID\n    reason: Optional rejection reason\n    \nReturns:\n    Success response","operationId":"reject_candidate_api_rules_candidates__id__reject_post","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","title":"Id"}},{"name":"reason","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Reason"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/rules/rollback":{"post":{"tags":["rules"],"summary":"Rollback Rules","description":"Rollback to a previous rule version.\n\nSteps:\n1. Validate target version exists\n2. Check for idempotency (already active)\n3. Deactivate all versions\n4. Activate target version\n5. Write audit entry\n\nArgs:\n    to_version: Target version ID to rollback to\n    \nReturns:\n    Success response","operationId":"rollback_rules_api_rules_rollback_post","parameters":[{"name":"to_version","in":"query","required":true,"schema":{"type":"string","title":"To Version"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/rules/versions":{"get":{"tags":["rules"],"summary":"List Versions","description":"List all rule versions (newest first, immutable history).\n\nReturns:\n    List of versions ordered by created_at DESC","operationId":"list_versions_api_rules_versions_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/VersionResponse"},"title":"Response List Versions Api Rules Versions Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/audit/export.csv":{"get":{"tags":["audit"],"summary":"Export Audit Csv","description":"Stream audit log as CSV (memory-bounded for 100k+ rows).\n\nFeatures:\n- Chunked streaming (1000 rows per batch)\n- Memory-bounded (no full dataset load)\n- UTC ISO8601 timestamps\n- All filters supported\n\nCSV Columns:\n- timestamp\n- tenant_id\n- user_id\n- action\n- txn_id\n- vendor_normalized\n- calibrated_p\n- threshold_used\n- not_auto_post_reason\n- cold_start_label_count\n- ruleset_version_id (placeholder)\n- model_version_id (placeholder)\n\nArgs:\n    start_ts: Start timestamp (ISO8601)\n    end_ts: End timestamp (ISO8601)\n    tenant_id: Filter by tenant\n    vendor: Filter by vendor (partial match)\n    action: Filter by action\n    reason: Filter by not_auto_post_reason\n    user_id: Filter by user\n    \nReturns:\n    Streaming CSV response","operationId":"export_audit_csv_api_audit_export_csv_get","parameters":[{"name":"start_ts","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Start Ts"}},{"name":"end_ts","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"End Ts"}},{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tenant Id"}},{"name":"vendor","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Vendor"}},{"name":"action","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Action"}},{"name":"reason","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Reason"}},{"name":"user_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/billing/status":{"get":{"tags":["billing"],"summary":"Get Billing Status","description":"Get current plan, limits, and usage for tenant.\n\nThis is the first Action call in any \"post\" flow for GPT paywall checks.","operationId":"get_billing_status_api_billing_status_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BillingStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/billing/create_checkout_session":{"post":{"tags":["billing"],"summary":"Create Checkout Session","description":"Create Stripe Checkout session for subscription.\n\nRequires:\n- STRIPE_SECRET_KEY in environment\n- Owner role\n\nReturns checkout URL or stub message if Stripe not configured.","operationId":"create_checkout_session_api_billing_create_checkout_session_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CheckoutRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CheckoutResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/billing/portal_link":{"get":{"tags":["billing"],"summary":"Get Portal Link","description":"Get Stripe Customer Portal link for managing subscription.\n\nRequires:\n- Existing subscription with stripe_customer_id\n- Owner role\n\nReturns portal URL or stub message if not configured.","operationId":"get_portal_link_api_billing_portal_link_get","parameters":[{"name":"tenant_id","in":"query","required":true,"schema":{"type":"string","title":"Tenant Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PortalResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/billing/stripe_webhook":{"post":{"tags":["billing"],"summary":"Stripe Webhook","description":"Handle Stripe webhook events.\n\nVerifies signature and processes:\n- customer.subscription.created\n- customer.subscription.updated\n- customer.subscription.deleted\n- invoice.payment_failed\n\nIdempotent: duplicate events are ignored.","operationId":"stripe_webhook_api_billing_stripe_webhook_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/notifications/settings":{"get":{"tags":["notifications"],"summary":"Get Notification Settings","description":"Get notification settings for tenant.\n\nRBAC: Owner and Staff can read.","operationId":"get_notification_settings_api_notifications_settings_get","parameters":[{"name":"tenant_id","in":"query","required":true,"schema":{"type":"string","title":"Tenant Id"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationSettings"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["notifications"],"summary":"Update Notification Settings","description":"Update notification settings.\n\nRBAC: Owner only.","operationId":"update_notification_settings_api_notifications_settings_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationSettings"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/notifications/test":{"post":{"tags":["notifications"],"summary":"Test Notification","description":"Send test notification.\n\nRBAC: Owner only.","operationId":"test_notification_api_notifications_test_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TestNotificationRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/onboarding/complete":{"post":{"tags":["onboarding"],"summary":"Complete Onboarding","description":"Complete onboarding wizard.\n\nCreates tenant config, imports CoA, ingests data, sets safety settings.\n\nRBAC: Owner only.","operationId":"complete_onboarding_api_onboarding_complete_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_complete_onboarding_api_onboarding_complete_post"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/receipts/":{"get":{"tags":["receipts"],"summary":"List Receipts","description":"List available receipts.\n\nReturns basic receipt metadata for UI listing.","operationId":"list_receipts_api_receipts__get","parameters":[{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/receipts/{receipt_id}/fields":{"get":{"tags":["receipts"],"summary":"Get Receipt Fields","description":"Get bounding boxes for receipt fields.\n\nReturns field overlays with normalized coordinates (0-1).","operationId":"get_receipt_fields_api_receipts__receipt_id__fields_get","parameters":[{"name":"receipt_id","in":"path","required":true,"schema":{"type":"string","title":"Receipt Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/receipts/{receipt_id}/pdf":{"get":{"tags":["receipts"],"summary":"Get Receipt Pdf","description":"Serve receipt PDF for viewing.\n\nIn production, would stream from blob storage.","operationId":"get_receipt_pdf_api_receipts__receipt_id__pdf_get","parameters":[{"name":"receipt_id","in":"path","required":true,"schema":{"type":"string","title":"Receipt Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/last7":{"get":{"tags":["analytics"],"summary":"Get Last 7 Days","description":"Get last 7 days of analytics reports.\n\nReturns list of daily reports sorted newest first.","operationId":"get_last_7_days_api_analytics_last7_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"type":"object"},"type":"array","title":"Response Get Last 7 Days Api Analytics Last7 Get"}}}}}}},"/api/analytics/events/types":{"get":{"tags":["analytics"],"summary":"Get Event Types","description":"Get list of available event types.","operationId":"get_event_types_api_analytics_events_types_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"type":"string"},"type":"object","title":"Response Get Event Types Api Analytics Events Types Get"}}}}}}},"/api/auth/qbo/start":{"get":{"tags":["qbo"],"summary":"Start Qbo Oauth","description":"Initialize QuickBooks Online OAuth2 flow.\n\nReturns 302 redirect to Intuit authorization page.","operationId":"start_qbo_oauth_api_auth_qbo_start_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/qbo/callback":{"get":{"tags":["qbo"],"summary":"Qbo Oauth Callback","description":"Handle QuickBooks Online OAuth2 callback.\n\nExchanges authorization code for tokens and stores them.\n\nArgs:\n    code: Authorization code from QBO\n    state: CSRF state token\n    realmId: QuickBooks company ID\n\nReturns:\n    Success message and redirect","operationId":"qbo_oauth_callback_api_auth_qbo_callback_get","parameters":[{"name":"code","in":"query","required":true,"schema":{"type":"string","title":"Code"}},{"name":"state","in":"query","required":true,"schema":{"type":"string","title":"State"}},{"name":"realmId","in":"query","required":true,"schema":{"type":"string","title":"Realmid"}},{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/qbo/status":{"get":{"tags":["qbo"],"summary":"Get Qbo Status","description":"Get QuickBooks Online connection status.\n\nReturns:\n    {\n        \"connected\": bool,\n        \"realm_id\": str,\n        \"token_age_sec\": int,\n        \"expires_in_sec\": int\n    }","operationId":"get_qbo_status_api_qbo_status_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConnectionStatus"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/qbo/journalentry":{"post":{"tags":["qbo"],"summary":"Post Journal Entry","description":"Post journal entry to QuickBooks Online with idempotency.\n\nArgs:\n    payload: Journal entry with txnDate, lines (amount, postingType, accountRef)\n\nReturns:\n    201 {qbo_doc_id, idempotent: false} on first post\n    200 {qbo_doc_id, idempotent: true} on duplicate\n\nError Codes:\n    400 - UNBALANCED_JE if debits != credits\n    401 - QBO_UNAUTHORIZED if not connected or token invalid\n    422 - QBO_VALIDATION if QBO rejects the entry\n    502 - QBO_UPSTREAM if QBO API unavailable","operationId":"post_journal_entry_api_qbo_journalentry_post","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/JEPayload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JEResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/actions":{"get":{"tags":["actions"],"summary":"Get Actions Discovery","description":"GPT Actions discovery endpoint.\n\nReturns:\n    {\n        \"version\": \"0.2.1-beta\",\n        \"links\": {\n            \"openapi\": \"/openapi.json\",\n            \"billing_portal\": \"/api/billing/portal\",\n            \"connect_quickbooks\": \"/api/auth/qbo/start\",\n            \"status\": \"/api/billing/status\",\n            \"qbo_status\": \"/api/qbo/status\"\n        },\n        \"paywall_md\": \"To post to QuickBooks, activate a plan...\",\n        \"cap\": {\n            \"free_daily_analyze\": 50\n        },\n        \"connected\": {\n            \"qbo\": true/false\n        },\n        \"entitlement\": {\n            \"active\": true/false,\n            \"plan\": \"starter|pro|firm|none\"\n        }\n    }\n\nNo authentication required for static links.\nStatus sections (connected, entitlement) depend on tenant_id if present.","operationId":"get_actions_discovery_actions_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ActionsDiscovery"}}}}}}},"/api/privacy/consent":{"get":{"tags":["privacy"],"summary":"Get Consent","description":"Get current training data consent status.\n\nGET /api/privacy/consent\n\nReturns:\n{\n  \"opt_in\": false,\n  \"actor\": null,\n  \"created_at\": \"2025-10-17T12:00:00Z\"\n}","operationId":"get_consent_api_privacy_consent_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConsentResponse"}}}}}},"post":{"tags":["privacy"],"summary":"Set Consent","description":"Set training data consent for tenant.\n\nPOST /api/privacy/consent\n{\n  \"opt_in\": true/false\n}\n\nReturns:\n{\n  \"opt_in\": true,\n  \"actor\": \"user@example.com\",\n  \"created_at\": \"2025-10-17T12:00:00Z\"\n}\n\nDefault: opt_out (no training data collected)","operationId":"set_consent_api_privacy_consent_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConsentRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConsentResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/privacy/labels/export":{"get":{"tags":["privacy"],"summary":"Export Labels","description":"Export redacted training labels for tenant.\n\nGET /api/privacy/labels/export?since=2025-10-01&until=2025-10-31\n\nReturns: JSONL stream of redacted label events\n\nFormat:\n{\"id\": 1, \"payload\": {...redacted...}, \"approved\": true, \"created_at\": \"...\"}\n{\"id\": 2, \"payload\": {...redacted...}, \"approved\": false, \"created_at\": \"...\"}","operationId":"export_labels_api_privacy_labels_export_get","parameters":[{"name":"since","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Since"}},{"name":"until","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Until"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/privacy/labels/purge":{"delete":{"tags":["privacy"],"summary":"Purge Labels","description":"Purge all training labels for tenant and rotate salt.\n\nDELETE /api/privacy/labels/purge\n\nReturns:\n{\n  \"deleted_count\": 42,\n  \"salt_rotated\": true\n}\n\nThis operation:\n- Deletes all label_events for tenant\n- Rotates the redaction salt (invalidates old hashes)\n- Cannot be undone","operationId":"purge_labels_api_privacy_labels_purge_delete","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PurgeResponse"}}}}}}},"/":{"get":{"summary":"Root","description":"Root endpoint.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/review":{"get":{"tags":["ui"],"summary":"Review Page","description":"Review inbox with reason-aware filtering.\n\nQuery params:\n- tenant_id: Filter by tenant\n- reason_filter: Filter by not_auto_post_reason\n- vendor_filter: Filter by vendor\n- min_amount, max_amount: Amount range","operationId":"review_page_review_get","parameters":[{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tenant Id"}},{"name":"reason_filter","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Reason Filter"}},{"name":"vendor_filter","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Vendor Filter"}},{"name":"min_amount","in":"query","required":false,"schema":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Min Amount"}},{"name":"max_amount","in":"query","required":false,"schema":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Max Amount"}}],"responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/metrics":{"get":{"tags":["ui"],"summary":"Metrics Page","description":"Metrics dashboard pulling from /api/metrics/latest.\n\nQuery params:\n- tenant_id: Filter by tenant\n- period: Time window (7d, 30d, 90d)","operationId":"metrics_page_metrics_get","parameters":[{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tenant Id"}},{"name":"period","in":"query","required":false,"schema":{"type":"string","default":"30d","title":"Period"}}],"responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/export":{"get":{"tags":["ui"],"summary":"Export Page","description":"Export Center with QBO CSV export and idempotency tracking.","operationId":"export_page_export_get","responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}}}}},"/export/qbo":{"post":{"tags":["ui"],"summary":"Trigger Export","description":"Trigger QBO CSV export (htmx endpoint).","operationId":"trigger_export_export_qbo_post","responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}}}}},"/firm":{"get":{"tags":["ui"],"summary":"Firm Console","description":"Firm Console - Multi-tenant management dashboard (Wave-2 Phase 1).\n\nRBAC:\n- Owner: sees all tenants, can modify settings\n- Staff: only sees assigned tenants, read-only","operationId":"firm_console_firm_get","parameters":[{"name":"authorization","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Authorization"}},{"name":"access_token","in":"cookie","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token"}}],"responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/rules":{"get":{"tags":["ui"],"summary":"Rules Console","description":"Rules Console - Adaptive rule learning workflow (Wave-2 Phase 1).\n\nTabs:\n- Candidates: Rules pending review\n- Accepted: Promoted rules (with rollback)\n- Rejected: Declined candidates","operationId":"rules_console_rules_get","parameters":[{"name":"active_tab","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"default":"candidates","title":"Active Tab"}}],"responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/audit":{"get":{"tags":["ui"],"summary":"Audit Log","description":"Audit Log Viewer - Complete decision history (Wave-2 Phase 1).\n\nFilterable by:\n- Date range\n- Tenant\n- Vendor\n- Action (auto_posted, reviewed, approved, rejected)\n- User\n\nSupports CSV export and deep-links to /explain/{txn_id}.","operationId":"audit_log_audit_get","parameters":[{"name":"date_from","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Date From"}},{"name":"date_to","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Date To"}},{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tenant Id"}},{"name":"vendor","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Vendor"}},{"name":"action","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Action"}},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"default":1,"title":"Page"}}],"responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/legal/terms":{"get":{"tags":["ui"],"summary":"Legal Terms","description":"Terms of Service (public access, no auth required).","operationId":"legal_terms_legal_terms_get","responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}}}}},"/legal/privacy":{"get":{"tags":["ui"],"summary":"Legal Privacy","description":"Privacy Policy (public access, no auth required).","operationId":"legal_privacy_legal_privacy_get","responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}}}}},"/legal/dpa":{"get":{"tags":["ui"],"summary":"Legal Dpa","description":"Data Processing Agreement (public access, no auth required).","operationId":"legal_dpa_legal_dpa_get","responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}}}}},"/support":{"get":{"tags":["ui"],"summary":"Support Page","description":"Support & Help Center (public access, no auth required).","operationId":"support_page_support_get","responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}}}}},"/healthz":{"get":{"summary":"Healthz","description":"Kubernetes-style health check with version.","operationId":"healthz_healthz_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/readyz":{"get":{"summary":"Readiness Check","description":"Readiness check endpoint for Kubernetes/load balancers (Sprint 9 Stage A).\n\nVerifies:\n- Database connectivity\n- Schema migrations at head\n- Write/read smoke test\n- OCR stub availability\n- Vector store status\n\nReturns:\n    JSON with detailed component status and timings","operationId":"readiness_check_readyz_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/jobs/{job_id}":{"get":{"summary":"Get Job Status Api","description":"Get status of a background job.\n\nArgs:\n    job_id: Job identifier\n    \nReturns:\n    Job status with progress and result","operationId":"get_job_status_api_api_jobs__job_id__get","parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/jobs/company/{company_id}":{"get":{"summary":"Get Company Jobs Api","description":"Get recent jobs for a company.\n\nArgs:\n    company_id: Company identifier\n    limit: Maximum jobs to return\n    \nReturns:\n    List of job statuses","operationId":"get_company_jobs_api_api_jobs_company__company_id__get","parameters":[{"name":"company_id","in":"path","required":true,"schema":{"type":"string","title":"Company Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":50,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/upload":{"post":{"summary":"Upload Statement","description":"Upload and parse a bank statement (CSV/OFX/PDF).\n\nReturns the parsed transactions.","operationId":"upload_statement_api_upload_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_statement_api_upload_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/post/propose":{"post":{"summary":"Propose Journal Entries","description":"Generate proposed journal entries for transactions.\n\nUses tiered decisioning: rules → embeddings → LLM → human review","operationId":"propose_journal_entries_api_post_propose_post","requestBody":{"content":{"application/json":{"schema":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Txn Ids"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/post/approve":{"post":{"summary":"Approve Journal Entries","description":"Approve or post journal entries.\n\n- approve: Mark as approved\n- post: Mark as posted and add to vendor knowledge","operationId":"approve_journal_entries_api_post_approve_post","parameters":[{"name":"action","in":"query","required":false,"schema":{"type":"string","default":"approve","title":"Action"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"array","items":{"type":"string"},"title":"Je Ids"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/post/commit":{"post":{"summary":"Commit Journal Entries","description":"Commit approved journal entries to QuickBooks Online with idempotency.\n\nRequest body:\n{\n    \"approvals\": [\n        {\n            \"txn_id\": \"t1\",\n            \"je\": {\n                \"txnDate\": \"2025-10-16\",\n                \"refNumber\": \"AB-1001\",\n                \"privateNote\": \"AI Bookkeeper\",\n                \"lines\": [\n                    {\"amount\": 150.00, \"postingType\": \"Debit\", \"accountRef\": {\"value\": \"46\"}},\n                    {\"amount\": 150.00, \"postingType\": \"Credit\", \"accountRef\": {\"value\": \"7\"}}\n                ]\n            }\n        }\n    ]\n}\n\nResponse:\n{\n    \"results\": [\n        {\"txn_id\": \"t1\", \"qbo_doc_id\": \"123\", \"idempotent\": false, \"status\": \"posted\"},\n        {\"txn_id\": \"t2\", \"error\": {\"code\": \"UNBALANCED_JE\", \"message\": \"...\"}, \"status\": \"error\"}\n    ]\n}\n\nErrors (global):\n- 402 ENTITLEMENT_REQUIRED - If no active subscription or over monthly cap\n- 429 FREE_CAP_EXCEEDED - Should not apply to commit (only propose)\n\nErrors (per-item):\n- UNBALANCED_JE - Debits != credits\n- QBO_VALIDATION - QBO rejected entry\n- QBO_UPSTREAM - QBO API unavailable\n- QBO_UNAUTHORIZED - QBO not connected","operationId":"commit_journal_entries_api_post_commit_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/chart-of-accounts":{"get":{"summary":"Get Chart Of Accounts","description":"Get the chart of accounts.","operationId":"get_chart_of_accounts_api_chart_of_accounts_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/reconcile/run":{"post":{"summary":"Run Reconciliation","description":"Run reconciliation to match transactions with journal entries.\n\nReturns reconciliation results and statistics.","operationId":"run_reconciliation_api_reconcile_run_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/reconcile/unmatched":{"get":{"summary":"Get Unmatched","description":"Get unmatched transactions and orphaned journal entries.","operationId":"get_unmatched_api_reconcile_unmatched_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/ui/review":{"get":{"summary":"Review Page","description":"Render the review page for journal entries.","operationId":"review_page_ui_review_get","responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}}}}},"/api/export/journal-entries":{"get":{"summary":"Export Jes","description":"Export journal entries to CSV.","operationId":"export_jes_api_export_journal_entries_get","parameters":[{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/export/reconciliation":{"get":{"summary":"Export Recon","description":"Export reconciliation results to CSV.","operationId":"export_recon_api_export_reconciliation_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/export/general-ledger":{"get":{"summary":"Export Gl","description":"Export general ledger to CSV.","operationId":"export_gl_api_export_general_ledger_get","parameters":[{"name":"start_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Start Date"}},{"name":"end_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"End Date"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/export/trial-balance":{"get":{"summary":"Export Tb","description":"Export trial balance to CSV.","operationId":"export_tb_api_export_trial_balance_get","parameters":[{"name":"as_of_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"As Of Date"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/export/quickbooks":{"post":{"summary":"Export Quickbooks","description":"Export journal entries to QuickBooks format.\n\nArgs:\n    format: Export format ('iif' for QuickBooks Desktop, 'csv' for QBO)\n    status: Filter by status (posted, approved)","operationId":"export_quickbooks_api_export_quickbooks_post","parameters":[{"name":"format","in":"query","required":false,"schema":{"type":"string","default":"iif","title":"Format"}},{"name":"status","in":"query","required":false,"schema":{"type":"string","default":"posted","title":"Status"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/export/xero":{"post":{"summary":"Export Xero","description":"Export journal entries to Xero CSV format.","operationId":"export_xero_api_export_xero_post","parameters":[{"name":"status","in":"query","required":false,"schema":{"type":"string","default":"posted","title":"Status"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/import/quickbooks":{"post":{"summary":"Import Quickbooks Coa","description":"Import chart of accounts from QuickBooks.\n\nAccepts IIF or CSV format.","operationId":"import_quickbooks_coa_api_import_quickbooks_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_import_quickbooks_coa_api_import_quickbooks_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/import/xero":{"post":{"summary":"Import Xero Coa","description":"Import chart of accounts from Xero CSV export.","operationId":"import_xero_coa_api_import_xero_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_import_xero_coa_api_import_xero_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/pnl":{"get":{"summary":"Get Pnl","description":"Get Profit & Loss statement.","operationId":"get_pnl_api_analytics_pnl_get","parameters":[{"name":"company_id","in":"query","required":true,"schema":{"type":"string","title":"Company Id"}},{"name":"start_date","in":"query","required":true,"schema":{"type":"string","title":"Start Date"}},{"name":"end_date","in":"query","required":true,"schema":{"type":"string","title":"End Date"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/balance-sheet":{"get":{"summary":"Get Balance Sheet","description":"Get Balance Sheet.","operationId":"get_balance_sheet_api_analytics_balance_sheet_get","parameters":[{"name":"company_id","in":"query","required":true,"schema":{"type":"string","title":"Company Id"}},{"name":"as_of_date","in":"query","required":true,"schema":{"type":"string","title":"As Of Date"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/cashflow":{"get":{"summary":"Get Cashflow","description":"Get Cash Flow statement.","operationId":"get_cashflow_api_analytics_cashflow_get","parameters":[{"name":"company_id","in":"query","required":true,"schema":{"type":"string","title":"Company Id"}},{"name":"start_date","in":"query","required":true,"schema":{"type":"string","title":"Start Date"}},{"name":"end_date","in":"query","required":true,"schema":{"type":"string","title":"End Date"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/automation-metrics":{"get":{"summary":"Get Automation Stats","description":"Get automation performance metrics.","operationId":"get_automation_stats_api_analytics_automation_metrics_get","parameters":[{"name":"company_id","in":"query","required":true,"schema":{"type":"string","title":"Company Id"}},{"name":"days","in":"query","required":false,"schema":{"type":"integer","default":30,"title":"Days"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/automation-trend":{"get":{"summary":"Get Trend","description":"Get automation trend over time.","operationId":"get_trend_api_analytics_automation_trend_get","parameters":[{"name":"company_id","in":"query","required":true,"schema":{"type":"string","title":"Company Id"}},{"name":"days","in":"query","required":false,"schema":{"type":"integer","default":90,"title":"Days"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/health":{"get":{"summary":"Health Check","description":"Health check endpoint.","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/setup/create-admin":{"post":{"summary":"Create Admin User","description":"Create admin user for production setup.","operationId":"create_admin_user_api_setup_create_admin_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ActionsDiscovery":{"properties":{"version":{"type":"string","title":"Version"},"links":{"additionalProperties":{"type":"string"},"type":"object","title":"Links"},"paywall_md":{"type":"string","title":"Paywall Md"},"cap":{"additionalProperties":{"type":"integer"},"type":"object","title":"Cap"},"connected":{"additionalProperties":{"type":"boolean"},"type":"object","title":"Connected"},"entitlement":{"type":"object","title":"Entitlement"}},"type":"object","required":["version","links","paywall_md","cap","connected","entitlement"],"title":"ActionsDiscovery","description":"Actions discovery response."},"BillingLimits":{"properties":{"tx_cap":{"type":"integer","title":"Tx Cap"},"bulk_approve":{"type":"boolean","title":"Bulk Approve","default":false},"included_companies":{"type":"integer","title":"Included Companies","default":1}},"type":"object","required":["tx_cap"],"title":"BillingLimits","description":"Billing limits model."},"BillingStatusResponse":{"properties":{"active":{"type":"boolean","title":"Active"},"plan":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Plan"},"limits":{"$ref":"#/components/schemas/BillingLimits"},"usage":{"$ref":"#/components/schemas/BillingUsage"},"trial_ends_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Trial Ends At"},"subscription_status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Subscription Status"}},"type":"object","required":["active","limits","usage"],"title":"BillingStatusResponse","description":"Billing status response."},"BillingUsage":{"properties":{"tx_analyzed":{"type":"integer","title":"Tx Analyzed"},"tx_posted":{"type":"integer","title":"Tx Posted"},"daily_analyze":{"type":"integer","title":"Daily Analyze","default":0},"daily_explain":{"type":"integer","title":"Daily Explain","default":0}},"type":"object","required":["tx_analyzed","tx_posted"],"title":"BillingUsage","description":"Billing usage model."},"Body_complete_onboarding_api_onboarding_complete_post":{"properties":{"coa_method":{"type":"string","title":"Coa Method"},"coa_template":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Coa Template"},"autopost_threshold":{"type":"number","title":"Autopost Threshold","default":0.9},"llm_budget":{"type":"number","title":"Llm Budget","default":50.0},"coa_file":{"anyOf":[{"type":"string","format":"binary"},{"type":"null"}],"title":"Coa File"},"transactions_file":{"anyOf":[{"type":"string","format":"binary"},{"type":"null"}],"title":"Transactions File"},"receipts":{"anyOf":[{"items":{"type":"string","format":"binary"},"type":"array"},{"type":"null"}],"title":"Receipts"}},"type":"object","required":["coa_method"],"title":"Body_complete_onboarding_api_onboarding_complete_post"},"Body_import_quickbooks_coa_api_import_quickbooks_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"}},"type":"object","required":["file"],"title":"Body_import_quickbooks_coa_api_import_quickbooks_post"},"Body_import_xero_coa_api_import_xero_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"}},"type":"object","required":["file"],"title":"Body_import_xero_coa_api_import_xero_post"},"Body_upload_statement_api_upload_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"}},"type":"object","required":["file"],"title":"Body_upload_statement_api_upload_post"},"CandidateResponse":{"properties":{"id":{"type":"string","title":"Id"},"vendor_pattern":{"type":"string","title":"Vendor Pattern"},"suggested_account":{"type":"string","title":"Suggested Account"},"evidence":{"additionalProperties":{"type":"number"},"type":"object","title":"Evidence"},"status":{"type":"string","title":"Status"},"created_at":{"type":"string","title":"Created At"}},"type":"object","required":["id","vendor_pattern","suggested_account","evidence","status","created_at"],"title":"CandidateResponse","description":"Rule candidate response."},"CheckoutRequest":{"properties":{"tenant_id":{"type":"string","title":"Tenant Id"},"plan":{"type":"string","title":"Plan"},"coupon":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Coupon"}},"type":"object","required":["tenant_id","plan"],"title":"CheckoutRequest","description":"Checkout session request."},"CheckoutResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"checkout_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Checkout Url"},"session_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Session Id"},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message"}},"type":"object","required":["success"],"title":"CheckoutResponse","description":"Checkout session response."},"ConnectionStatus":{"properties":{"connected":{"type":"boolean","title":"Connected"},"realm_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Realm Id"},"token_age_sec":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Token Age Sec"},"expires_in_sec":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Expires In Sec"}},"type":"object","required":["connected"],"title":"ConnectionStatus","description":"QBO connection status."},"ConsentRequest":{"properties":{"opt_in":{"type":"boolean","title":"Opt In"}},"type":"object","required":["opt_in"],"title":"ConsentRequest","description":"Consent toggle request."},"ConsentResponse":{"properties":{"opt_in":{"type":"boolean","title":"Opt In"},"actor":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Actor"},"created_at":{"type":"string","title":"Created At"}},"type":"object","required":["opt_in","created_at"],"title":"ConsentResponse","description":"Consent status response."},"DryRunRequest":{"properties":{"candidate_ids":{"items":{"type":"string"},"type":"array","title":"Candidate Ids"},"tenant_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tenant Id"}},"type":"object","required":["candidate_ids"],"title":"DryRunRequest","description":"Dry-run request."},"DryRunResponse":{"properties":{"before":{"type":"object","title":"Before"},"after":{"type":"object","title":"After"},"affected_txn_ids":{"items":{"type":"string"},"type":"array","title":"Affected Txn Ids"},"deltas":{"type":"object","title":"Deltas"}},"type":"object","required":["before","after","affected_txn_ids","deltas"],"title":"DryRunResponse","description":"Dry-run response with impact analysis."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"JELine":{"properties":{"amount":{"type":"number","title":"Amount"},"postingType":{"type":"string","title":"Postingtype"},"accountRef":{"additionalProperties":{"type":"string"},"type":"object","title":"Accountref"}},"type":"object","required":["amount","postingType","accountRef"],"title":"JELine","description":"Journal entry line."},"JEPayload":{"properties":{"txnDate":{"type":"string","title":"Txndate"},"lines":{"items":{"$ref":"#/components/schemas/JELine"},"type":"array","title":"Lines"},"refNumber":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Refnumber"},"privateNote":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Privatenote","default":"AI Bookkeeper"}},"type":"object","required":["txnDate","lines"],"title":"JEPayload","description":"Journal entry payload."},"JEResponse":{"properties":{"status":{"type":"integer","title":"Status"},"qbo_doc_id":{"type":"string","title":"Qbo Doc Id"},"idempotent":{"type":"boolean","title":"Idempotent"},"message":{"type":"string","title":"Message"}},"type":"object","required":["status","qbo_doc_id","idempotent","message"],"title":"JEResponse","description":"Journal entry posting response."},"LoginRequest":{"properties":{"email":{"type":"string","format":"email","title":"Email"},"password":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Password"},"magic_token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Magic Token"}},"type":"object","required":["email"],"title":"LoginRequest","description":"Login request body."},"LoginResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"user_id":{"type":"string","title":"User Id"},"email":{"type":"string","title":"Email"},"role":{"type":"string","title":"Role"},"token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Token"}},"type":"object","required":["success","user_id","email","role"],"title":"LoginResponse","description":"Login response."},"NotificationSettings":{"properties":{"tenant_id":{"type":"string","title":"Tenant Id"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"slack_webhook_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Slack Webhook Url"},"psi_alert":{"type":"boolean","title":"Psi Alert","default":false},"budget_fallback":{"type":"boolean","title":"Budget Fallback","default":false},"je_imbalance":{"type":"boolean","title":"Je Imbalance","default":false},"export_completed":{"type":"boolean","title":"Export Completed","default":false},"coldstart_graduated":{"type":"boolean","title":"Coldstart Graduated","default":false}},"type":"object","required":["tenant_id"],"title":"NotificationSettings","description":"Notification settings request/response."},"PortalResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"portal_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Portal Url"},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message"}},"type":"object","required":["success"],"title":"PortalResponse","description":"Customer portal response."},"PurgeResponse":{"properties":{"deleted_count":{"type":"integer","title":"Deleted Count"},"salt_rotated":{"type":"boolean","title":"Salt Rotated"}},"type":"object","required":["deleted_count","salt_rotated"],"title":"PurgeResponse","description":"Purge result response."},"SignupRequest":{"properties":{"email":{"type":"string","format":"email","title":"Email"},"password":{"type":"string","title":"Password"},"full_name":{"type":"string","title":"Full Name"},"company_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Company Name"}},"type":"object","required":["email","password","full_name"],"title":"SignupRequest","description":"Signup request body."},"TenantResponse":{"properties":{"id":{"type":"string","title":"Id"},"name":{"type":"string","title":"Name"},"tier":{"type":"string","title":"Tier"},"autopost_enabled":{"type":"boolean","title":"Autopost Enabled"},"autopost_threshold":{"type":"number","title":"Autopost Threshold"},"llm_tenant_cap_usd":{"type":"number","title":"Llm Tenant Cap Usd"},"automation_rate":{"type":"number","title":"Automation Rate"},"review_rate":{"type":"number","title":"Review Rate"},"review_backlog_count":{"type":"integer","title":"Review Backlog Count"},"psi_vendor":{"type":"number","title":"Psi Vendor"},"psi_amount":{"type":"number","title":"Psi Amount"},"fallback_active":{"type":"boolean","title":"Fallback Active"},"last_export_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Export At"},"created_at":{"type":"string","title":"Created At"},"updated_at":{"type":"string","title":"Updated At"}},"type":"object","required":["id","name","tier","autopost_enabled","autopost_threshold","llm_tenant_cap_usd","automation_rate","review_rate","review_backlog_count","psi_vendor","psi_amount","fallback_active","last_export_at","created_at","updated_at"],"title":"TenantResponse","description":"Tenant details response."},"TenantSettings":{"properties":{"autopost_enabled":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Autopost Enabled"},"autopost_threshold":{"anyOf":[{"type":"number","maximum":0.98,"minimum":0.8},{"type":"null"}],"title":"Autopost Threshold"},"llm_tenant_cap_usd":{"anyOf":[{"type":"number","maximum":10000.0,"minimum":0.0},{"type":"null"}],"title":"Llm Tenant Cap Usd"}},"type":"object","title":"TenantSettings","description":"Tenant settings update request."},"TestNotificationRequest":{"properties":{"tenant_id":{"type":"string","title":"Tenant Id"},"channel":{"type":"string","title":"Channel"}},"type":"object","required":["tenant_id","channel"],"title":"TestNotificationRequest","description":"Test notification request."},"UserInfo":{"properties":{"user_id":{"type":"string","title":"User Id"},"email":{"type":"string","title":"Email"},"role":{"type":"string","title":"Role"},"tenants":{"items":{"type":"string"},"type":"array","title":"Tenants"}},"type":"object","required":["user_id","email","role","tenants"],"title":"UserInfo","description":"Current user information."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"VersionResponse":{"properties":{"version_id":{"type":"string","title":"Version Id"},"created_by":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Created By"},"created_at":{"type":"string","title":"Created At"},"is_active":{"type":"boolean","title":"Is Active"}},"type":"object","required":["version_id","created_by","created_at","is_active"],"title":"VersionResponse","description":"Rule version response."}}}}